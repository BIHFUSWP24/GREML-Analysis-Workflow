library(tidyr)
library(dplyr)

# input_files <- snakemake@input[["hsq"]]
# output_file <- snakemake@output[["file"]]
# KEY <- snakemake@params[["key"]]

input_files <- c("/sc-projects/sc-proj-dh-ukb-intergenics/analysis/development/lesi11/build/ukb_imp_v3/heritabilities/Original.measurements_standing_height_f50_0_0.hsq", "/sc-projects/sc-proj-dh-ukb-intergenics/analysis/development/lesi11/build/ukb_imp_v3/heritabilities/Original.measurements_body_mass_index_bmi_f21001_0_0.hsq", "/sc-projects/sc-proj-dh-ukb-intergenics/analysis/development/lesi11/build/ukb_imp_v3/heritabilities/Original.measurements_waist_circumference_f48_0_0.hsq", "/sc-projects/sc-proj-dh-ukb-intergenics/analysis/development/lesi11/build/ukb_imp_v3/heritabilities/Original.measurements_hip_circumference_f49_0_0.hsq", "/sc-projects/sc-proj-dh-ukb-intergenics/analysis/development/lesi11/build/ukb_imp_v3/heritabilities/Original.measurements_systolic_blood_pressure_automated_reading_f4080.hsq", "/sc-projects/sc-proj-dh-ukb-intergenics/analysis/development/lesi11/build/ukb_imp_v3/heritabilities/Original.measurements_diastolic_blood_pressure_automated_reading_f4079.hsq", "/sc-projects/sc-proj-dh-ukb-intergenics/analysis/development/lesi11/build/ukb_imp_v3/heritabilities/Original.coronary_heart_disease.hsq", "/sc-projects/sc-proj-dh-ukb-intergenics/analysis/development/lesi11/build/ukb_imp_v3/heritabilities/Original.diabetes2.hsq", "/sc-projects/sc-proj-dh-ukb-intergenics/analysis/development/lesi11/build/ukb_imp_v3/heritabilities/kernelPCA100%.measurements_standing_height_f50_0_0.hsq", "/sc-projects/sc-proj-dh-ukb-intergenics/analysis/development/lesi11/build/ukb_imp_v3/heritabilities/kernelPCA100%.measurements_body_mass_index_bmi_f21001_0_0.hsq", "/sc-projects/sc-proj-dh-ukb-intergenics/analysis/development/lesi11/build/ukb_imp_v3/heritabilities/kernelPCA100%.measurements_waist_circumference_f48_0_0.hsq", "/sc-projects/sc-proj-dh-ukb-intergenics/analysis/development/lesi11/build/ukb_imp_v3/heritabilities/kernelPCA100%.measurements_hip_circumference_f49_0_0.hsq", "/sc-projects/sc-proj-dh-ukb-intergenics/analysis/development/lesi11/build/ukb_imp_v3/heritabilities/kernelPCA100%.measurements_systolic_blood_pressure_automated_reading_f4080.hsq", "/sc-projects/sc-proj-dh-ukb-intergenics/analysis/development/lesi11/build/ukb_imp_v3/heritabilities/kernelPCA100%.measurements_diastolic_blood_pressure_automated_reading_f4079.hsq", "/sc-projects/sc-proj-dh-ukb-intergenics/analysis/development/lesi11/build/ukb_imp_v3/heritabilities/kernelPCA100%.coronary_heart_disease.hsq", "/sc-projects/sc-proj-dh-ukb-intergenics/analysis/development/lesi11/build/ukb_imp_v3/heritabilities/kernelPCA100%.diabetes2.hsq", "/sc-projects/sc-proj-dh-ukb-intergenics/analysis/development/lesi11/build/ukb_imp_v3/heritabilities/PCA100%.measurements_standing_height_f50_0_0.hsq", "/sc-projects/sc-proj-dh-ukb-intergenics/analysis/development/lesi11/build/ukb_imp_v3/heritabilities/PCA100%.measurements_body_mass_index_bmi_f21001_0_0.hsq", "/sc-projects/sc-proj-dh-ukb-intergenics/analysis/development/lesi11/build/ukb_imp_v3/heritabilities/PCA100%.measurements_waist_circumference_f48_0_0.hsq", "/sc-projects/sc-proj-dh-ukb-intergenics/analysis/development/lesi11/build/ukb_imp_v3/heritabilities/PCA100%.measurements_hip_circumference_f49_0_0.hsq", "/sc-projects/sc-proj-dh-ukb-intergenics/analysis/development/lesi11/build/ukb_imp_v3/heritabilities/PCA100%.measurements_systolic_blood_pressure_automated_reading_f4080.hsq", "/sc-projects/sc-proj-dh-ukb-intergenics/analysis/development/lesi11/build/ukb_imp_v3/heritabilities/PCA100%.measurements_diastolic_blood_pressure_automated_reading_f4079.hsq", "/sc-projects/sc-proj-dh-ukb-intergenics/analysis/development/lesi11/build/ukb_imp_v3/heritabilities/PCA100%.coronary_heart_disease.hsq", "/sc-projects/sc-proj-dh-ukb-intergenics/analysis/development/lesi11/build/ukb_imp_v3/heritabilities/PCA100%.diabetes2.hsq", "/sc-projects/sc-proj-dh-ukb-intergenics/analysis/development/lesi11/build/ukb_imp_v3/heritabilities/kernelPCA99%5.measurements_standing_height_f50_0_0.hsq", "/sc-projects/sc-proj-dh-ukb-intergenics/analysis/development/lesi11/build/ukb_imp_v3/heritabilities/kernelPCA99%5.measurements_body_mass_index_bmi_f21001_0_0.hsq", "/sc-projects/sc-proj-dh-ukb-intergenics/analysis/development/lesi11/build/ukb_imp_v3/heritabilities/kernelPCA99%5.measurements_waist_circumference_f48_0_0.hsq", "/sc-projects/sc-proj-dh-ukb-intergenics/analysis/development/lesi11/build/ukb_imp_v3/heritabilities/kernelPCA99%5.measurements_hip_circumference_f49_0_0.hsq", "/sc-projects/sc-proj-dh-ukb-intergenics/analysis/development/lesi11/build/ukb_imp_v3/heritabilities/kernelPCA99%5.measurements_systolic_blood_pressure_automated_reading_f4080.hsq", "/sc-projects/sc-proj-dh-ukb-intergenics/analysis/development/lesi11/build/ukb_imp_v3/heritabilities/kernelPCA99%5.measurements_diastolic_blood_pressure_automated_reading_f4079.hsq", "/sc-projects/sc-proj-dh-ukb-intergenics/analysis/development/lesi11/build/ukb_imp_v3/heritabilities/kernelPCA99%5.coronary_heart_disease.hsq", "/sc-projects/sc-proj-dh-ukb-intergenics/analysis/development/lesi11/build/ukb_imp_v3/heritabilities/kernelPCA99%5.diabetes2.hsq", "/sc-projects/sc-proj-dh-ukb-intergenics/analysis/development/lesi11/build/ukb_imp_v3/heritabilities/PCA99%5.measurements_standing_height_f50_0_0.hsq", "/sc-projects/sc-proj-dh-ukb-intergenics/analysis/development/lesi11/build/ukb_imp_v3/heritabilities/PCA99%5.measurements_body_mass_index_bmi_f21001_0_0.hsq", "/sc-projects/sc-proj-dh-ukb-intergenics/analysis/development/lesi11/build/ukb_imp_v3/heritabilities/PCA99%5.measurements_waist_circumference_f48_0_0.hsq", "/sc-projects/sc-proj-dh-ukb-intergenics/analysis/development/lesi11/build/ukb_imp_v3/heritabilities/PCA99%5.measurements_hip_circumference_f49_0_0.hsq", "/sc-projects/sc-proj-dh-ukb-intergenics/analysis/development/lesi11/build/ukb_imp_v3/heritabilities/PCA99%5.measurements_systolic_blood_pressure_automated_reading_f4080.hsq", "/sc-projects/sc-proj-dh-ukb-intergenics/analysis/development/lesi11/build/ukb_imp_v3/heritabilities/PCA99%5.measurements_diastolic_blood_pressure_automated_reading_f4079.hsq", "/sc-projects/sc-proj-dh-ukb-intergenics/analysis/development/lesi11/build/ukb_imp_v3/heritabilities/PCA99%5.coronary_heart_disease.hsq", "/sc-projects/sc-proj-dh-ukb-intergenics/analysis/development/lesi11/build/ukb_imp_v3/heritabilities/PCA99%5.diabetes2.hsq", "/sc-projects/sc-proj-dh-ukb-intergenics/analysis/development/lesi11/build/ukb_imp_v3/heritabilities/kernelPCA99%.measurements_standing_height_f50_0_0.hsq", "/sc-projects/sc-proj-dh-ukb-intergenics/analysis/development/lesi11/build/ukb_imp_v3/heritabilities/kernelPCA99%.measurements_body_mass_index_bmi_f21001_0_0.hsq", "/sc-projects/sc-proj-dh-ukb-intergenics/analysis/development/lesi11/build/ukb_imp_v3/heritabilities/kernelPCA99%.measurements_waist_circumference_f48_0_0.hsq", "/sc-projects/sc-proj-dh-ukb-intergenics/analysis/development/lesi11/build/ukb_imp_v3/heritabilities/kernelPCA99%.measurements_hip_circumference_f49_0_0.hsq", "/sc-projects/sc-proj-dh-ukb-intergenics/analysis/development/lesi11/build/ukb_imp_v3/heritabilities/kernelPCA99%.measurements_systolic_blood_pressure_automated_reading_f4080.hsq", "/sc-projects/sc-proj-dh-ukb-intergenics/analysis/development/lesi11/build/ukb_imp_v3/heritabilities/kernelPCA99%.measurements_diastolic_blood_pressure_automated_reading_f4079.hsq", "/sc-projects/sc-proj-dh-ukb-intergenics/analysis/development/lesi11/build/ukb_imp_v3/heritabilities/kernelPCA99%.coronary_heart_disease.hsq", "/sc-projects/sc-proj-dh-ukb-intergenics/analysis/development/lesi11/build/ukb_imp_v3/heritabilities/kernelPCA99%.diabetes2.hsq", "/sc-projects/sc-proj-dh-ukb-intergenics/analysis/development/lesi11/build/ukb_imp_v3/heritabilities/PCA99%.measurements_standing_height_f50_0_0.hsq", "/sc-projects/sc-proj-dh-ukb-intergenics/analysis/development/lesi11/build/ukb_imp_v3/heritabilities/PCA99%.measurements_body_mass_index_bmi_f21001_0_0.hsq", "/sc-projects/sc-proj-dh-ukb-intergenics/analysis/development/lesi11/build/ukb_imp_v3/heritabilities/PCA99%.measurements_waist_circumference_f48_0_0.hsq", "/sc-projects/sc-proj-dh-ukb-intergenics/analysis/development/lesi11/build/ukb_imp_v3/heritabilities/PCA99%.measurements_hip_circumference_f49_0_0.hsq", "/sc-projects/sc-proj-dh-ukb-intergenics/analysis/development/lesi11/build/ukb_imp_v3/heritabilities/PCA99%.measurements_systolic_blood_pressure_automated_reading_f4080.hsq", "/sc-projects/sc-proj-dh-ukb-intergenics/analysis/development/lesi11/build/ukb_imp_v3/heritabilities/PCA99%.measurements_diastolic_blood_pressure_automated_reading_f4079.hsq", "/sc-projects/sc-proj-dh-ukb-intergenics/analysis/development/lesi11/build/ukb_imp_v3/heritabilities/PCA99%.coronary_heart_disease.hsq", "/sc-projects/sc-proj-dh-ukb-intergenics/analysis/development/lesi11/build/ukb_imp_v3/heritabilities/PCA99%.diabetes2.hsq")
output_file <- "/sc-projects/sc-proj-dh-ukb-intergenics/analysis/development/lesi11/results/ukb_imp_v3/analysis1_heritability_summary.tsv"
manipulation <- c(rep("none", 8), rep("kernelpca", 8), rep("pca", 8), rep("kernelpca", 8), rep("pca", 8), rep("kernelpca", 8), rep("pca", 8))

file_names <- basename(input_files)

parts <- strsplit(file_names, ".", fixed = TRUE)
profiles <- sapply(parts, function(x) { return(x[1]) })
phenotype_list <- sapply(parts, function(x) { return(x[2]) })

heritabilities <- sapply(input_files, function(file) { 
    if (file.size(file) == 0) {
        "Error"
    } else {
        data <- read.delim(file, header = TRUE, sep = "\t", fill = TRUE)
        data[["Variance"]][4]}})

standard_errors <- sapply(input_files, function(file) { 
    if (file.size(file) == 0) {
        "Error"
    } else {
        data <- read.delim(file, header = TRUE, sep = "\t", fill = TRUE)
        data[["SE"]][4]}})

df <- data.frame(Profile=profiles, Phenotype=phenotype_list, Category=manipulation, Heritability=heritabilities, SE=standard_errors, stringsAsFactors = FALSE)
rownames(df) <- NULL

write.table(df, output_file, sep = "\t", row.names = FALSE, quote = FALSE, col.names = TRUE)
